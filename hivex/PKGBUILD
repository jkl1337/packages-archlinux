# Maintainer: John K. Luebs <jkluebs (at) luebsphoto.com>

pkgname=hivex
pkgver=1.3.3
pkgrel=1
pkgdesc="System for extracting the contents of Windows Registry."
arch=("i686" "x86_64")
url="http://libguestfs.org"
license=("LGPL2.1")
depends=("python2"
         "perl")
makedepends=("perl-io-stringy"
             "perl-test-simple"
             "ocaml-findlib"
             "ocaml"
             "libxml2")
options=(!emptydirs !libtool)
sha1sums=('4565d6e3d94c5ad558f403ab2aa0ad19e7ccf738'
          '23ec6217abd7eb669f9725996ca70f93fcaf6fb5'
          'c635c2bc45a22334ebabd266b16849c07353081c')
source=("http://libguestfs.org/download/$pkgname/$pkgname-$pkgver.tar.gz"
        "ruby-1.9-str-api.patch"
        "perl-strip-rpath.patch")
optdepends=('ruby: ruby extension' 'libxml2: hive to XML conversion')

build() {
    cd $srcdir/$pkgname-$pkgver
    patch -Np1 -i "$srcdir/ruby-1.9-str-api.patch" || exit 1
    patch -Np1 -i "$srcdir/perl-strip-rpath.patch" || exit 1

    ./configure --prefix=/usr PYTHON=python2
    make
}

package() {
    cd $srcdir/$pkgname-$pkgver
    make DESTDIR=$pkgdir install
}
