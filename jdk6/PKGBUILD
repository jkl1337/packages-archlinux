# Maintainer: Thomas Dziedzic < gostrc at gmail >
# Contributor: Geoffroy Carrier <geoffroy.carrier@aur.archlinux.org>
# Contributor: Jason Chu <jason@archlinux.org>
# Contributor: Daniel J Griffiths <ghost1227@archlinux.us>
# Contributor: Guillaume ALAUX <Guillaume at alaux dot net>
# Contributor: John K. Luebs <jkluebs@luebsphoto.com>

pkgname=jdk6
pkgver=6u26
pkgrel=1
pkgdesc="Sun/Oracle's implementation of tha Java 6 specification"
arch=('i686' 'x86_64')
  [ "${CARCH}" = 'i686' ]   && _arch=i586
  [ "${CARCH}" = 'x86_64' ] && _arch=x64
url='http://java.sun.com'
license=('custom')
# oracle moved it ...
#        'https://jdk-distros.dev.java.net/source/browse/*checkout*/jdk-distros/trunk/utils/construct.sh'
source=("http://download.oracle.com/otn-pub/java/jdk/6u26-b03/jdk-6u26-linux-${_arch}.bin"
        'construct.sh::http://java.net/projects/jdk-distros/sources/svn/content/trunk/utils/construct.sh?raw=true'
        'java-control-panel.desktop'
        'java-monitoring-and-management-console.desktop'
        'java-policy-settings.desktop'
        'java-visualvm.desktop'
        'java-web-start.desktop'
        'jre.profile'
        'jre.profile.csh'
        'jdk.profile'
        'jdk.profile.csh'
        'derby-network-server'
        'derby-network-server.conf'
        'javaws-launcher')

[ "${CARCH}" = 'i686' ] && md5sums=('89ab2af35371a0b996dd00f07e57218d')
[ "${CARCH}" = 'x86_64' ] && md5sums=('cbb1577434c3c43e882357a1901ba18f')
md5sums+=('94065b612df0046d9ae758943f9f6a75'
         '43319a217ac1afdbd01a251d71ab29a7'
         '48cd18dc262dfdf3fcad23a450984cf1'
         '7719567b6ab221d4aa29cd8975c8d56b'
         '646ed2ad5db62f8a5bb39b5cf1ebc781'
         '7147b4cc0046eec68fbaf7b699ab1c1b'
         '52750a050de01757ad4726c906fb0d44'
         'a1a56ff5c650f8416175bb2e5a5166c7'
         '803ceeb0d98abdf800cf7452fce12e7c'
         '3ce59ff37dc2598a5fcf66613851e1d5'
         'a279e195e249000646895d93e199860d'
         '4bdff6982c66d24a879c424aaac3d04d'
         '45c15a6b4767288f2f745598455ea2bf')

build() {
  mkdir unbundle-jdk
  cd unbundle-jdk
  sh ../jdk-${pkgver}-linux-$_arch.bin --accept-license
  cd ..
  sh construct.sh unbundle-jdk linux-jdk linux-jre
}

<< COMMENT
package() {
  pkgdesc="Sun/Oracle's Java Runtime Environment"
  depends=('glibc' 'libxtst')
  #provides=('j2re' 'java-runtime=6')
  install='jre.install'

  # main files
  mkdir -p ${pkgdir}/opt/java6
  cp -R linux-jdk/jre ${pkgdir}/opt/java6

  # profiles
  # install -D ${srcdir}/jre.profile \
  #   ${pkgdir}/etc/profile.d/jre.sh
  # install -D ${srcdir}/jre.profile.csh \
  #   ${pkgdir}/etc/profile.d/jre.csh

  # licenses
  install -d ${pkgdir}/usr/share/licenses/jre6
  install -m644 ${pkgdir}/opt/java6/jre/COPYRIGHT \
    ${pkgdir}/usr/share/licenses/jre6
  install -m644 ${pkgdir}/opt/java6/jre/LICENSE \
    ${pkgdir}/usr/share/licenses/jre6
  install -m644 ${pkgdir}/opt/java6/jre/THIRDPARTYLICENSEREADME.txt \
    ${pkgdir}/usr/share/licenses/jre6

  # Fix system prefs folder (FS#18872)
  install -d ${pkgdir}/etc/.java/.systemPrefs

  # Fix FS#22509 - [jre] Clicking a .jnlp file does not launch that file but launch javaws -viewer instead 
  install ${srcdir}/javaws-launcher \
    ${pkgdir}/opt/java6/jre/bin
}
COMMENT

package() {
  pkgdesc="Sun/Oracle's Java Development Kit"
  depends=('glibc' 'jre6')
  #provides=('java-environment=6' 'j2sdk')
  install='jdk.install'

  #copy icon
  # install -D -m644 ${srcdir}/linux-jdk/jre/lib/desktop/icons/hicolor/48x48/apps/sun-java.png \
  #   ${pkgdir}/usr/share/pixmaps/java.png

  # main files
  rm -rf linux-jdk/jre
  install -d ${pkgdir}/opt
  mv linux-jdk ${pkgdir}/opt/java6

  # profiles
  # install -D ${srcdir}/jdk.profile \
  #   ${pkgdir}/etc/profile.d/jdk.sh
  # install -D ${srcdir}/jdk.profile.csh \
  #   ${pkgdir}/etc/profile.d/jdk.csh

  # licenses
  install -d ${pkgdir}/usr/share/licenses/jdk6
  install -m644 ${pkgdir}/opt/java6/COPYRIGHT \
    ${pkgdir}/usr/share/licenses/jdk6
  install -m644 ${pkgdir}/opt/java6/LICENSE \
    ${pkgdir}/usr/share/licenses/jdk6
  install -m644 ${pkgdir}/opt/java6/THIRDPARTYLICENSEREADME.txt \
    ${pkgdir}/usr/share/licenses/jdk6

  # desktop entries
  # install -Dm644 ${srcdir}/java-control-panel.desktop \
  #   ${pkgdir}/usr/share/applications/java-control-panel.desktop
  # install -Dm644 ${srcdir}/java-monitoring-and-management-console.desktop \
  #   ${pkgdir}/usr/share/applications/java-monitoring-and-management-console.desktop
  # install -Dm644 ${srcdir}/java-policy-settings.desktop \
  #   ${pkgdir}/usr/share/applications/java-policy-settings.desktop
  # install -Dm644 ${srcdir}/java-visualvm.desktop \
  #   ${pkgdir}/usr/share/applications/java-visualvm.desktop
  # install -Dm644 ${srcdir}/java-web-start.desktop \
  #   ${pkgdir}/usr/share/applications/java-web-start.desktop

  # javadb (apache derby) daemon files
  # install -D ${srcdir}/derby-network-server \
  #   ${pkgdir}/etc/rc.d/derby-network-server
  # install -D -m644 ${srcdir}/derby-network-server.conf \
  #   ${pkgdir}/etc/conf.d/derby-network-server

  # remove dangling links, probably need to find out more about them
  for i in kinit ktab klist; do
    rm ${pkgdir}/opt/java6/bin/${i}
    rm ${pkgdir}/opt/java6/man/ja_JP.eucJP/man1/${i}.1
    rm ${pkgdir}/opt/java6/man/man1/${i}.1
  done
}
